Tool:          Iconv
Last Updated:  January 10 2018
Version:       1.15
Compile:       May 18 2018

Comments:

 - Download: http://ftp.gnu.org/gnu/libiconv/
 
 
 - Instructions: https://www.codeproject.com/Articles/302012/How-to-Build-libiconv-with-Microsoft-Visual-Studio
 
 - Copy File:
	cp ./lib/relocatable.h ./Project/libiconv/
	cp ./lib/relocatable.c ./Project/libiconv/
	cp ./lib/iconv.c ./Project/libiconv/
	
	cp ./libcharset/lib/localcharset.c ./Project/libiconv/
	cp ./libcharset/include/localcharset.h.build.in ./Project/libiconv/localcharset.h
	cp ./windows/libiconv.rc ./Project/libiconv/

	cp ./include/iconv.h.build.in ./Project/include/iconv.h
	cp ./config.h.in ./Project/include/config.h

	cp ./lib/*.h ./Project/include/
	cp ./lib/*.def  ./Project/include/
	
 - Preprocessors:
  - BUILDING_LIBICONV
  - BUILDING_LIBCHARSET
  - LIBICONV_EXPORTS
  
  
 - Add into line 4: libiconv.rc
 
	///////////////////////// ADD //////////////////////
	#define PACKAGE_VERSION_MAJOR       1
	#define PACKAGE_VERSION_MINOR       15
	#define PACKAGE_VERSION_SUBMINOR    0
	#define PACKAGE_VERSION_STRING      "1.15"
	////////////////////////////////////////////////////
	
	add #include "resource.h" (generated by VS)

 - Open localcharset.c and delete or comment the lines 81 as follows:

	///////////////////////// DELETE ///////////////////////
	///* Get LIBDIR.  */
	//#ifndef LIBDIR
	//# include "configmake.h"
	//#endif
	////////////////////////////////////////////////////////////////////////////////

	
 - Open iconv.c and delete or comment the lines 250 and add three lines there as follows:

	///////////////////////// DELETE ///////////////////////
	//size_t iconv (iconv_t icd,
	//              ICONV_CONST char* * inbuf, size_t *inbytesleft,
	//              char* * outbuf, size_t *outbytesleft)
	///////////////////////// ?? / ADD / ????????? //////////////////////
	size_t iconv (iconv_t icd,
				  const char* * inbuf, size_t *inbytesleft,
				  char* * outbuf, size_t *outbytesleft)
	////////////////////////////////////////////////////////////////////////////////

 - Open localcharset.h and delete or comment the lines 21 and add 7 lines there as follows:

	///////////////////////// DELETE ///////////////////////
	//#if @HAVE_VISIBILITY@ && BUILDING_LIBCHARSET
	//#define LIBCHARSET_DLL_EXPORTED __attribute__((__visibility__("default")))
	//#else
	//#define LIBCHARSET_DLL_EXPORTED
	//#endif
	///////////////////////// ADD //////////////////////
	#ifdef BUILDING_LIBCHARSET
	#define LIBCHARSET_DLL_EXPORTED __declspec(dllexport)
	#elif USING_STATIC_LIBICONV
	#define LIBCHARSET_DLL_EXPORTED
	#else
	#define LIBCHARSET_DLL_EXPORTED __declspec(dllimport)
	#endif
	////////////////////////////////////////////////////////////////////////////////

 - Open config.h in the project include folder "...\libiconv\include" and delete or comment the lines 30 as follows:

	///////////////////////// DELETE ///////////////////////
	///* Define as good substitute value for EILSEQ. */
	//#undef EILSEQ
	////////////////////////////////////////////////////////////////////////////////
	Otherwise you can redefine EILSEQ as good substitute value.

 - Open iconv.h in the project include folder "...\libiconv\include"

	///////////////////////// DELETE ///////////////////////
	//#if @HAVE_WCHAR_T@
	///////////////////////// ADD //////////////////////
	#if HAVE_WCHAR_T
	////////////////////////////////////////////////////////////////////////////////

	///////////////////////// DELETE ///////////////////////
	//#if @USE_MBSTATE_T@
	///////////////////////// ADD //////////////////////
	#if USE_MBSTATE_T
	////////////////////////////////////////////////////////////////////////////////

	///////////////////////// DELETE ///////////////////////
	//#if @USE_MBSTATE_T@
	//#if @BROKEN_WCHAR_H@
	///////////////////////// ADD //////////////////////
	#if USE_MBSTATE_T
	#if BROKEN_WCHAR_H
	////////////////////////////////////////////////////////////////////////////////

	///////////////////////// DELETE ///////////////////////
	//extern LIBICONV_DLL_EXPORTED size_t iconv (iconv_t cd, @ICONV_CONST@ char* * inbuf, 
	//size_t *inbytesleft, char* * outbuf, size_t *outbytesleft);
	///////////////////////// ADD //////////////////////
	extern LIBICONV_DLL_EXPORTED size_t iconv (iconv_t cd, const char* * inbuf, 
		size_t *inbytesleft, char* * outbuf, size_t *outbytesleft);
	////////////////////////////////////////////////////////////////////////////////

	///////////////////////// DELETE ///////////////////////
	//#if @HAVE_VISIBILITY@ && BUILDING_LIBICONV
	//#define LIBICONV_DLL_EXPORTED __attribute__((__visibility__("default")))
	//#else
	//#define LIBICONV_DLL_EXPORTED
	//#endif
	//extern LIBICONV_DLL_EXPORTED @DLL_VARIABLE@ int _libiconv_version; /* Likewise */
	///////////////////////// ADD //////////////////////
	#if BUILDING_LIBICONV
	#define LIBICONV_DLL_EXPORTED __declspec(dllexport)
	#elif USING_STATIC_LIBICONV
	#define LIBICONV_DLL_EXPORTED
	#else
	#define LIBICONV_DLL_EXPORTED __declspec(dllimport)
	#endif
	extern LIBICONV_DLL_EXPORTED int _libiconv_version; /* Likewise */
	////////////////////////////////////////////////////////////////////////////////
